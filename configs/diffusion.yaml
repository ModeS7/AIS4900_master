# Unified Diffusion Training Configuration
#
# This is the primary config for training diffusion models (DDPM or Rectified Flow)
# on brain MRI data. Supports both 2D and 3D training via spatial_dims setting.
#
# Usage:
#   # 2D training (default)
#   python -m medgen.scripts.train mode=bravo strategy=rflow
#
#   # 3D training via spatial_dims override
#   python -m medgen.scripts.train mode=bravo strategy=rflow model.spatial_dims=3
#
#   # 3D training via 3D model config
#   python -m medgen.scripts.train mode=bravo strategy=rflow model=default_3d
#
#   # 3D with volume settings
#   python -m medgen.scripts.train model=default_3d volume.depth=32 volume.height=128
#
#   # Custom settings
#   python -m medgen.scripts.train model.image_size=256 training.epochs=1000
#
#   # View resolved config
#   python -m medgen.scripts.train --cfg job

defaults:
  - model: default    # Model architecture (DiffusionModelUNet)
  - strategy: ddpm    # ddpm.yaml or rflow.yaml
  - mode: bravo       # seg.yaml, bravo.yaml, or dual.yaml
  - training: default # Training hyperparameters
  - optional volume: default      # 3D volume dimensions (required when model.spatial_dims=3)
  - optional latent: default      # Latent diffusion settings (disabled by default)
  - optional controlnet: default  # ControlNet conditioning (disabled by default)
  - paths: local      # local.yaml or cluster.yaml (AFTER training so it can override verbose)
  - _self_

# Hydra configuration
# Output structure: runs/diffusion_2d/{mode}/{exp_name}{strategy}_{size}_{timestamp}
# Use training.name to add experiment prefix: training.name=exp1_ -> exp1_rflow_128_...
# Note: mode.subdir allows overriding directory name (e.g., seg_conditioned uses 'seg')
hydra:
  run:
    dir: ${paths.model_dir}/diffusion_2d/${oc.select:mode.subdir,mode.name}/${oc.select:training.name,""}${strategy.name}_${model.image_size}_${now:%Y%m%d-%H%M%S}
  sweep:
    dir: ${paths.model_dir}/diffusion_2d/multirun/${now:%Y%m%d-%H%M%S}
    subdir: ${hydra.job.num}
