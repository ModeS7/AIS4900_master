# Main Diffusion Training Configuration
#
# This is the primary config for training diffusion models (DDPM or Rectified Flow)
# on brain MRI data. Composes from sub-configs via defaults list.
#
# Usage:
#   # Default: DDPM, 128px, bravo mode
#   python -m medgen.scripts.train
#
#   # Rectified Flow, dual mode
#   python -m medgen.scripts.train strategy=rflow mode=dual
#
#   # Custom settings
#   python -m medgen.scripts.train model.image_size=256 training.epochs=1000
#
#   # View resolved config
#   python -m medgen.scripts.train --cfg job

defaults:
  - paths: local      # local.yaml or cluster.yaml
  - model: default    # Model architecture (DiffusionModelUNet)
  - strategy: ddpm    # ddpm.yaml or rflow.yaml
  - mode: bravo       # seg.yaml, bravo.yaml, or dual.yaml
  - training: default # Training hyperparameters
  - optional latent: default      # Latent diffusion settings (disabled by default)
  - optional controlnet: default  # ControlNet conditioning (disabled by default)
  - _self_

# Hydra configuration
# Output structure: runs/diffusion_2d/{mode}/{exp_name}{strategy}_{size}_{timestamp}
# Use training.name to add experiment prefix: training.name=exp1_ -> exp1_rflow_128_...
hydra:
  run:
    dir: ${paths.model_dir}/diffusion_2d/${mode.name}/${oc.select:training.name,""}${strategy.name}_${model.image_size}_${now:%Y%m%d-%H%M%S}
  sweep:
    dir: ${paths.model_dir}/diffusion_2d/multirun/${now:%Y%m%d-%H%M%S}
    subdir: ${hydra.job.num}
