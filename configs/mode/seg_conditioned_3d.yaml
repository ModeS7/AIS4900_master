# 3D Segmentation Conditioned Mode - Size bin conditioned 3D mask generation
#
# Generates 3D segmentation volumes conditioned on tumor size distribution.
# Uses a N-dimensional vector where each element is the count of tumors
# in that size bin (3D Feret diameter, aligned with RANO-BM thresholds).
#
# Key difference from 2D: Uses 3D connected components so tumors touching
# in ANY direction (including depth) count as ONE tumor.
#
# Size bins (mm): [0-3, 3-6, 6-10, 10-15, 15-20, 20-30, 30+]
# Example: [0, 0, 2, 0, 0, 0, 1] = 2 tumors 6-10mm + 1 tumor 30+mm
#
# For DIFFUSION training:
#   in_channels: 1 = noisy_seg
#   out_channels: 1 = predicted seg
#   conditioning: 7-dim size bin vector (FiLM modulation on timestep embed)
#   Dataloader: create_seg_dataloader()

name: seg_conditioned
subdir: seg  # Use 'seg' directory for all seg variants
is_conditional: true
in_channels: 1   # noisy_seg only (conditioning via embedding, not concat)
out_channels: 1  # predicted noise/velocity for seg
image_keys: [seg]
description: "3D segmentation volume generation conditioned on tumor size distribution"

# Size bin configuration
# Bins aligned with RANO-BM thresholds: 10mm, 20mm, 30mm
# Last bin is 30+mm (overflow)
size_bins:
  edges: [0, 3, 6, 10, 15, 20, 30]  # mm boundaries
  num_bins: 7  # 6 bounded bins + 1 overflow bin (30+)
  max_count: 10  # Cap embedding vocabulary at 0-10
  embedding_dim: 32  # Embedding dimension per bin
  # Voxel spacing for physical measurements [depth_mm, height_mm, width_mm]
  # Default: 1mm depth (typical brain MRI), pixel spacing for H/W
  # For 256x256 with 240mm FOV: 240/256 = 0.9375mm
  voxel_spacing: [1.0, 0.9375, 0.9375]

# Classifier-free guidance (CFG) training
cfg_dropout_prob: 0.15  # Probability of dropping conditioning (15% = unconditional)
